<html>
	<head>
		<title>
			Todo App
		</title>
		<style>
			ul{
				list-style: none;
				padding: 0;
				margin: 0;
			}
			.hidden{
				display: none;
			}
		</style>
	</head>
	<body>
		<form method="post" action="/todos/create">
			<input type="text" name="description"/>
			<input type="submit" value="Create">
		</form>
		<div id="error" class="hidden">Something went wrong!</div>
		<ul>
			{% for d in data%}
			<li><input class="check-completed" data-id="{{d.id}}" type="checkbox" {%if d.comleted %} checked {% endif %}/> {{d.description}}
			</li>
			{% endfor %}
		</ul>
		<script>
			const checkboxes = document.querySelectorAll('.check-completed');
			for(let i = 0 ; i <checkboxes.length ; i++){
				const checkbox = checkboxes[i];
				checkbox.onchange = function(e){
					console.log('event', e);
					const newCompleted = e.target.checked;
					const todoId = e.target.dataset['id'];
					console.log('newCompleted', newCompleted);
					console.log('todoId',todoId)
					fetch('/todos/'+ todoId +'/set-completed',{
						method: 'POST',
						body: JSON.stringify({
							'completed': newCompleted
						}),
						header:{
							'Content-Type': 'application/json'
						}
					})
					.then(function(){
						document.getElementById('error').className = 'hidden';
					})
					.catch(function(){
						document.getElementById('error').className = '';
					})
				}
			}
		</script>
	</body>
</html>
